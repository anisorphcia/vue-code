{"version":3,"file":"vue.js","sources":["../src/observe/arr.js","../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// 获取数组的方法\r\nlet oldArrayProtoMethods = Array.prototype\r\nconsole.log('oldArrayProtoMethods', oldArrayProtoMethods)\r\n// 继承\r\nexport let ArrayMethods = Object.create(oldArrayProtoMethods)\r\nconsole.log('ArrayMethods', ArrayMethods)\r\n// 劫持\r\nlet methods = [\r\n    \"push\",\r\n    \"pop\",\r\n    \"unshift\",\r\n    \"shift\",\r\n    \"splice\"\r\n]\r\n\r\nmethods.forEach(item => {\r\n    console.log('ArrayMethods[item]', ArrayMethods[item])\r\n    ArrayMethods[item] = function(...args){\r\n        console.log('劫持数组')\r\n        let result = oldArrayProtoMethods[item].apply(this, args) // this -> list:[]\r\n        // 对添加的数组对象进行劫持\r\n        let inserted\r\n        switch(item){\r\n                case 'push':\r\n                case 'unshift':\r\n                    inserted = args\r\n                    break\r\n                case 'splice':\r\n                    inserted = args.splice(2)\r\n                    break\r\n        }\r\n        console.log('inserted', inserted)\r\n        let ob = this.__ob__\r\n        if (inserted) {\r\n            ob.observeArray(inserted)\r\n        }\r\n        return result\r\n        }\r\n})\r\n","import { ArrayMethods } from './arr'\r\n\r\nexport function observer(data){\r\n    if(typeof data !== 'object' || data === null){\r\n        return data;\r\n    }\r\n    return new Observer(data)\r\n}\r\n\r\nclass Observer{\r\n    constructor(value){\r\n        // 给data定义一个属性\r\n        Object.defineProperty(value, '__ob__', {\r\n            enumerable: false,\r\n            value: this\r\n        })\r\n        if (Array.isArray(value)){\r\n            console.log('array', value)\r\n            value.__proto__ = ArrayMethods\r\n            // 数组中的元素是对象\r\n            this.observeArray(value)\r\n        } else {\r\n            this.walk(value)\r\n        }\r\n    }\r\n    walk(data){\r\n        let keys = Object.keys(data)\r\n        for(let i = 0; i < keys.length; ++i){\r\n            let key = keys[i]\r\n            let value = data[key]\r\n            defineReactive(data, key, value)\r\n        }\r\n    }\r\n    observeArray(value){\r\n        // value.forEach(el => {\r\n        //     observer(el)\r\n        // })\r\n        for(let i = 0; i < value.length; ++i){\r\n            observer(value[i])\r\n        }\r\n    }\r\n}\r\n\r\n// 只能对对象中的属性劫持，无法操作数组\r\nfunction defineReactive(data, key, value){\r\n    observer(value)\r\n    Object.defineProperty(data, key, {\r\n        get(){\r\n            return value\r\n        },\r\n        set(newValue){\r\n            if(newValue === value) return\r\n            value = newValue\r\n        }\r\n    })\r\n}","import { observer } from \"./observe/index\"\r\n\r\nexport function initState(vm){\r\n    let opts = vm.$options\r\n    if(opts.data){\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction initData(vm){\r\n    let data = vm.$options.data\r\n    // data() 指向window\r\n    // data.call(vm) 改变this指向\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n    // 数据劫持\r\n    observer(data)   \r\n}","import { initState } from \"./initState\"\r\n\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options){\r\n        console.log(options)\r\n        let vm = this\r\n        vm.$options = options\r\n        // init\r\n        initState(vm)\r\n    }\r\n}\r\n","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options){\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","console","log","ArrayMethods","Object","create","methods","forEach","item","_len","arguments","length","args","_key","result","apply","inserted","splice","ob","__ob__","observeArray","observer","data","_typeof","Observer","value","_classCallCheck","defineProperty","enumerable","isArray","__proto__","walk","_createClass","key","keys","i","defineReactive","get","set","newValue","initState","vm","opts","$options","initData","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}